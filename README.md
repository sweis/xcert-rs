# xcert

> **Warning:** This project was generated by Claude (Anthropic AI). Review all
> code carefully before using in production. The implementation has not been
> audited by human security experts.

A fast, memory-safe command-line tool for inspecting X.509 certificates.
Designed as a modern replacement for `openssl x509` with a simpler interface,
JSON output, and subcommand-based CLI.

`xcert` is read-only -- it parses and displays certificates but does not sign
or create them.

## Features

- **Auto-detection** of PEM vs DER format (no `-inform` flag needed)
- **Subcommand-based CLI** (`show`, `field`, `check`, `convert`)
- **JSON output** with `--json` for scripting and machine consumption
- **Certificate checks** for expiry, hostname, email, and IP matching
- **SHA-256/384/512/SHA-1** fingerprint computation
- **RSA, ECDSA (P-256/P-384/P-521), Ed25519** key types
- **Memory-safe** Rust implementation with `unsafe` code forbidden at the
  workspace level

## Build

Requires Rust 1.70+.

```bash
# Debug build
cargo build

# Release build (recommended for benchmarks and production use)
cargo build --release
```

The release binary is at `target/release/xcert`.

### Install locally

```bash
cargo install --path xcert
```

### Run tests

```bash
cargo test
```

There are 121 integration tests covering parsing, field extraction, extensions,
fingerprints, checks, conversion, display, and degenerate/malformed inputs.

## Usage

### `xcert show` -- Display certificate information

```bash
# Display a PEM certificate (equivalent to: openssl x509 -text -noout -in cert.pem)
xcert show cert.pem

# Display a DER certificate
xcert show cert.der

# JSON output
xcert show --json cert.pem

# Include signature bytes
xcert show --all cert.pem

# Read from stdin
cat cert.pem | xcert show
```

### `xcert field` -- Extract a single field

```bash
# Subject (equivalent to: openssl x509 -subject -noout -in cert.pem)
xcert field subject cert.pem

# Issuer
xcert field issuer cert.pem

# Serial number
xcert field serial cert.pem

# Validity dates
xcert field not-before cert.pem
xcert field not-after cert.pem

# SHA-256 fingerprint (default)
xcert field fingerprint cert.pem

# SHA-384 fingerprint
xcert field fingerprint --digest sha384 cert.pem

# Public key in PEM format
xcert field public-key cert.pem

# RSA modulus
xcert field modulus cert.pem

# Email addresses from subject and SAN
xcert field emails cert.pem

# Subject Alternative Names
xcert field san cert.pem

# SAN as JSON
xcert field san --json cert.pem

# OCSP responder URLs
xcert field ocsp-url cert.pem

# Key Usage / Extended Key Usage
xcert field key-usage cert.pem
xcert field ext-key-usage cert.pem

# All extensions
xcert field extensions cert.pem
```

### `xcert check` -- Validate certificate properties

Returns exit code 0 for pass, 1 for fail. Useful in scripts and CI.

```bash
# Check if cert expires within 30 days (2592000 seconds)
xcert check expiry 2592000 cert.pem

# Check hostname match (RFC 6125 with wildcard support)
xcert check host www.example.com cert.pem

# Check email match
xcert check email user@example.com cert.pem

# Check IP match (IPv4 and IPv6)
xcert check ip 93.184.216.34 cert.pem

# Use in a script
if xcert check expiry 604800 cert.pem; then
  echo "Certificate valid for at least 7 more days"
else
  echo "Certificate expires within 7 days!"
fi
```

### `xcert convert` -- Convert between formats

```bash
# PEM to DER
xcert convert --to der cert.pem --out cert.der

# DER to PEM (output to stdout)
xcert convert --to pem cert.der

# Pipe through stdin
cat cert.pem | xcert convert --to der > cert.der
```

### Comparison with `openssl x509`

| openssl x509 | xcert |
|---|---|
| `openssl x509 -text -noout -in cert.pem` | `xcert show cert.pem` |
| `openssl x509 -subject -noout -in cert.pem` | `xcert field subject cert.pem` |
| `openssl x509 -issuer -noout -in cert.pem` | `xcert field issuer cert.pem` |
| `openssl x509 -serial -noout -in cert.pem` | `xcert field serial cert.pem` |
| `openssl x509 -dates -noout -in cert.pem` | `xcert field not-before` / `not-after` |
| `openssl x509 -fingerprint -sha256 -noout -in cert.pem` | `xcert field fingerprint cert.pem` |
| `openssl x509 -pubkey -noout -in cert.pem` | `xcert field public-key cert.pem` |
| `openssl x509 -modulus -noout -in cert.pem` | `xcert field modulus cert.pem` |
| `openssl x509 -email -noout -in cert.pem` | `xcert field emails cert.pem` |
| `openssl x509 -ext subjectAltName -noout -in cert.pem` | `xcert field san cert.pem` |
| `openssl x509 -ocsp_uri -noout -in cert.pem` | `xcert field ocsp-url cert.pem` |
| `openssl x509 -checkend 3600 -noout -in cert.pem` | `xcert check expiry 3600 cert.pem` |
| `openssl x509 -checkhost foo.com -noout -in cert.pem` | `xcert check host foo.com cert.pem` |
| `openssl x509 -checkip 1.2.3.4 -noout -in cert.pem` | `xcert check ip 1.2.3.4 cert.pem` |
| `openssl x509 -checkemail a@b.com -noout -in cert.pem` | `xcert check email a@b.com cert.pem` |
| `openssl x509 -outform DER -in c.pem -out c.der` | `xcert convert --to der c.pem --out c.der` |

## Benchmarks

All benchmarks run 1000 iterations measuring wall-clock time (including process
startup). Environment: Linux 4.4.0, OpenSSL 3.0.13.

### Results: xcert vs OpenSSL

| Operation | OpenSSL avg (ms) | xcert avg (ms) | Speedup |
|---|--:|--:|--:|
| Parse + text display (root-ca.pem) | 43.24 | 11.63 | 3.7x |
| Parse + text display (server.pem) | 44.34 | 11.51 | 3.9x |
| Parse + text display (many-extensions.pem) | 46.34 | 11.17 | 4.1x |
| Subject extraction (root-ca.pem) | 46.76 | 11.49 | 4.1x |
| Subject extraction (server.pem) | 48.54 | 11.22 | 4.3x |
| Subject extraction (many-extensions.pem) | 48.15 | 10.87 | 4.4x |
| SHA-256 fingerprint (root-ca.pem) | 46.68 | 10.97 | 4.3x |
| SHA-256 fingerprint (server.pem) | 48.55 | 11.19 | 4.3x |
| SHA-256 fingerprint (many-extensions.pem) | 46.85 | 11.21 | 4.2x |
| PEM to DER (root-ca.pem) | 48.75 | 11.10 | 4.4x |
| PEM to DER (server.pem) | 47.45 | 11.09 | 4.3x |
| PEM to DER (many-extensions.pem) | 47.66 | 11.24 | 4.2x |
| DER parse + text display (root-ca.der) | 49.54 | 12.13 | 4.1x |
| Hostname check (server.pem) | 61.92 | 11.75 | 5.3x |

**Summary:** xcert is **3.7x -- 5.3x faster** than `openssl x509` across all
operations. Both tools are dominated by process startup overhead, but the xcert
binary is significantly lighter (~4 MB static vs OpenSSL's dynamic linking and
larger initialization path).

### Running benchmarks yourself

**OpenSSL baseline:**

```bash
bash bench/openssl-baseline.sh
```

**xcert benchmarks:**

```bash
# Build release binary first
cargo build --release

# Then run the same operations manually, e.g.:
time target/release/xcert show tests/certs/server.pem > /dev/null
time target/release/xcert field fingerprint tests/certs/server.pem > /dev/null
time target/release/xcert check host www.example.com tests/certs/server.pem
```

Detailed OpenSSL baseline data is in [`docs/performance-baseline.md`](docs/performance-baseline.md).

## Fuzzing

The project includes [cargo-fuzz](https://github.com/rust-fuzz/cargo-fuzz)
targets for coverage-guided fuzzing with libFuzzer.

```bash
# Install cargo-fuzz (requires nightly)
rustup install nightly
cargo install cargo-fuzz

# List targets
cargo +nightly fuzz list
# parse_cert, parse_der, parse_pem, roundtrip

# Run a fuzz target
cargo +nightly fuzz run parse_cert -- -max_total_time=60

# Run with the included ASN.1 dictionary for better coverage
cargo +nightly fuzz run parse_cert -- -max_total_time=300 -dict=fuzz/x509.dict
```

Seed corpus files are pre-populated from the test certificates.

## Security

- `unsafe` code is **denied** at the workspace level
- Clippy warns on `unwrap()`, `expect()`, `panic!()`, and array indexing
- 13 degenerate/malformed certificate test vectors exercise error paths
- 4 fuzz targets for continuous testing of parsing robustness
- `cargo-audit` is supported for dependency vulnerability scanning:
  `cargo install cargo-audit && cargo audit`

## Project structure

```
x509-rs/
  xcert-lib/          # Library crate (parsing, display, checks, conversion)
    src/
      lib.rs          # Public API
      parser.rs       # PEM/DER parsing, CertificateInfo construction
      fields.rs       # Data types (CertificateInfo, extensions, etc.)
      fingerprint.rs  # SHA-256/384/512/SHA-1 fingerprints
      display.rs      # Human-readable text and JSON output
      check.rs        # Expiry, hostname, email, IP checks
      convert.rs      # PEM <-> DER conversion
    tests/
      integration.rs  # 121 integration tests
  xcert/              # CLI binary crate
    src/main.rs       # clap-based CLI with subcommands
  fuzz/               # cargo-fuzz targets and corpus
  bench/              # Benchmark scripts
  tests/certs/        # Test certificates (PEM, DER, degenerate)
  docs/               # Design documents and reference
```

## License

See [LICENSE](LICENSE) for details.
