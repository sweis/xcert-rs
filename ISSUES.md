# Known Issues

Issues identified during code review. Ordered roughly by severity.

## Security / Correctness

### 1. No certificate revocation checking (CRL/OCSP)

`verify.rs` does not check whether certificates have been revoked. Neither
CRL Distribution Points nor OCSP responder URLs are consulted during chain
verification. A revoked intermediate or leaf certificate will verify
successfully.

**Impact:** A revoked certificate chain will pass verification.

**Files:** `xcert-lib/src/verify.rs`

---

### 2. Key Usage not checked during chain verification

RFC 5280 Section 4.2.1.3 requires that CA certificates used to sign other
certificates have the `keyCertSign` bit set in the Key Usage extension. The
`verify_chain_with_options()` function checks `BasicConstraints` (CA flag and
pathLenConstraint) but does not verify Key Usage. A certificate with
`CA:TRUE` but without `keyCertSign` in Key Usage would be accepted as a valid
issuer.

**Impact:** Chains with improperly constrained CA certs may verify.

**Files:** `xcert-lib/src/verify.rs` (around line 398)

---

### 3. `check_expiry` does not validate `notBefore`

`check_expiry()` only checks whether `not_after` is beyond the deadline. It
does not check whether `not_before` is in the past. A certificate whose
validity period has not yet started will return `true` (valid).

**Impact:** Not-yet-valid certificates are treated as valid by `check_expiry`.

**Files:** `xcert-lib/src/check.rs:10-24`

---

### 4. No Name Constraints checking

The verification module does not enforce the Name Constraints extension
(RFC 5280 Section 4.2.1.10). A CA certificate with Name Constraints limiting
its scope to a specific domain could be used to sign certificates for
arbitrary domains without triggering a verification error.

**Files:** `xcert-lib/src/verify.rs`

---

## Code Quality

### 5. Duplicate hostname matching logic

Hostname matching (including RFC 6125 wildcard support) is implemented twice:

- `check.rs:hostname_matches()` (line 92) + `check.rs:check_host()` (line 31)
- `verify.rs:hostname_matches()` (line 690) + `verify.rs:verify_hostname()` (line 644)

The two implementations are functionally identical but operate on different
types (`CertificateInfo` vs `X509Certificate`). The `verify.rs` version also
has its own `extract_san_dns_names()` and `extract_cn()` helpers that
duplicate logic already present in `parser.rs`.

**Suggestion:** Extract shared hostname matching into `util.rs` or a common
module. The type-specific wrappers can remain in their respective modules.

**Files:** `xcert-lib/src/check.rs`, `xcert-lib/src/verify.rs`

---

### 6. Duplicate OID-to-short-name mappings

OID-to-short-name conversion exists in two places with different coverage:

- `parser.rs:oid_to_short_name()` (line 138) -- 14 OIDs including street,
  title, postalCode, GN
- `verify.rs:oid_short_name()` (line 724) -- 10 OIDs

Using different names for the same certificate fields in different contexts
(parsing vs verification output) can cause confusion.

**Suggestion:** Consolidate into a single function in `util.rs`.

**Files:** `xcert-lib/src/parser.rs`, `xcert-lib/src/verify.rs`

---

### 7. `TrustStore::add_pem_bundle` return value is misleading

`add_pem_bundle()` returns the count of PEM certificates found by
`parse_pem_chain()`, but silently ignores individual `add_der()` failures
(line 227: `let _ = self.add_der(&cert_der)`). The returned count may exceed
the number of certificates actually added to the store.

**Files:** `xcert-lib/src/verify.rs:222-229`

---

### 8. Unused `load_reference` function in tests

The `load_reference()` helper function (integration.rs line 33) is never
called, producing a compiler warning. It was likely intended for use with
the reference test vectors in `tests/certs/reference/` but no tests
currently compare against them programmatically.

**Files:** `xcert-lib/tests/integration.rs:33`

---

### 9. 116 reference test vectors are unused

The `tests/certs/reference/` directory contains 116 OpenSSL-generated
reference output files (subjects, serials, fingerprints, dates, text output,
etc.) that are not referenced by any test. These were generated by
`tests/certs/generate.sh` but the integration tests use inline assertions
rather than comparing against these files.

**Suggestion:** Either add tests that compare against reference outputs for
regression detection, or remove the unused reference files.

**Files:** `tests/certs/reference/*`

---

## Missing Features

### 10. No `--partial-chain` option

OpenSSL's `verify -partial_chain` flag allows verification to succeed if any
certificate in the chain (not just the root) is in the trust store. This is
useful for verifying leaf certificates directly when the leaf itself is trusted.

**Files:** `xcert-lib/src/verify.rs`

---

### 11. No Extended Key Usage checking during verification

The verification module does not check whether the leaf certificate's Extended
Key Usage extension permits the intended use (e.g., `serverAuth` for TLS
server certificates). OpenSSL performs this check by default.

**Files:** `xcert-lib/src/verify.rs`

---

### 12. No LICENSE file

The README references a LICENSE file but none exists in the repository.

---

## Minor

### 13. `docs/cli-interface.md` does not document `verify` subcommand

The CLI interface design document lists 4 subcommands (show, field, check,
convert) but does not mention the `verify` subcommand added later.

**Files:** `docs/cli-interface.md`

---

### 14. Version display is redundant

`display.rs` line 16 outputs `Version: 3 (v3)` which repeats the same
information twice. OpenSSL displays `Version: 3 (0x2)` showing both the
human-readable version and the encoded ASN.1 value.

**Files:** `xcert-lib/src/display.rs:16`

---

### 15. No CI configuration

The repository has no GitHub Actions workflow or other CI configuration.
Tests, clippy, and formatting are not automatically checked on PRs.
